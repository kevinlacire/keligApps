<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Kévin LACIRE">
  <title>Kêlig Apps</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
    crossorigin="anonymous"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/3.16.3/math.min.js"></script>
  <script src="https://raw.githubusercontent.com/mckamey/countdownjs/master/countdown.min.js"></script>
  <style>
    body {
      padding-top: 3.5rem;
    }
    .bold {
      font-weight: 800;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#">Kêlig Apps</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault"
      aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav mr-auto">
        <!-- <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li> -->
      </ul>
    </div>
  </nav>
  <div class="container">
    <h1>TopGaz</h1>
    <hr>
    <div class="row">
      <!-- <form class="form-inline"> -->
      <form class="col-md-6">
        <h3>Valeurs mesurées</h3>
        <div class="form-group">
          <label for="indexInitialCounter">Index compteur initial (en m<sup>3</sup>)</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">m<sup>3</sup></div>
            <input type="number" class="form-control" id="indexInitialCounter" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="indexCounter36s">Index compteur sur 36s</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">m<sup>3</sup></div>
            <input type="number" class="form-control" id="indexCounter36s" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="indexCounter100s">Index compteur sur 100s</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">m<sup>3</sup></div>
            <input type="number" class="form-control" id="indexCounter100s" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="pciNaturalGas">PCI gaz naturel (en nM<sup>3</sup>/h)</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">nM<sup>3</sup>/h</div>
            <input type="number" class="form-control" id="pciNaturalGas" value="11.5" placeholder="11.5" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="gasTemperature">Température du gaz (en °C)</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">°C</div>
            <input type="number" class="form-control" id="gasTemperature" value="15" placeholder="15" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="gasPressure">Pression du gaz (en milliBar)</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">mBar</div>
            <input type="number" class="form-control" id="gasPressure" value="21" placeholder="21" onchange="calculateAll()">
          </div>
        </div>
        <div class="form-group">
          <label for="atmosphericPressure">Pression atmosphérique (en milliBar)</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">mBar</div>
            <input type="number" class="form-control" id="atmosphericPressure" value="1013" placeholder="1013" onchange="calculateAll()">
          </div>
        </div>
      </form>
      <fieldset class="col-md-6">
        <h3>Résultats</h3>
        <hr>
        <div class="form-group">
          <label for="gasDebitM3">Débit gaz en m3/h</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">m<sup>3</sup>/h</div>
            <input type="number" class="form-control form-control-lg bold" id="gasDebitM3" readonly>
          </div>
        </div>
        <div class="form-group">
          <label for="gasDebitNM3">Débit gaz en nm3/h</label>
            <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">nM<sup>3</sup>/h</div>
              <input type="number" class="form-control form-control-lg bold" id="gasDebitNM3" readonly>
            </div>              
        </div>
        <div class="form-group">
          <label for="burnerPowerKW">Puissance bruleur en kW</label>
          <div class="input-group mb-2 mb-sm-0">
            <div class="input-group-addon">kW</div>
            <input type="number" class="form-control form-control-lg bold" id="burnerPowerKW" readonly>
          </div>            
        </div>
      </fieldset>
    </div>
  </div>
  <script>
      var calculateAll = function () {
        gasDebitM3();
        gasDebitNM3();
        burnerPowerKW();
      };

      var gasDebitM3 = function () {
        var _indexInitialCounter = math.bignumber(parseFloat($("#indexInitialCounter").val()));
        var _indexCounter36s = math.bignumber(parseFloat($("#indexCounter36s").val()));
        var _indexCounter100s = math.bignumber(parseFloat($("#indexCounter100s").val()));

        var precision = _indexCounter100s != "NaN" ? math.bignumber(_indexCounter100s) : math.bignumber(_indexCounter36s);
        var multiplicator = _indexCounter100s != "NaN" ? math.bignumber(36) : math.bignumber(100);

        if (math.compare(_indexInitialCounter, precision) > 0) {
          return 0;
        }

        var res = parseFloat(math.multiply(math.subtract(precision, _indexInitialCounter), multiplicator));
        $("#gasDebitM3").val(res.toFixed(2));
        return res;
      };

      var gasDebitNM3 = function () {
        var _gasDebitM3 = math.bignumber(gasDebitM3());

        if (_gasDebitM3 == 0) {
          return 0;
        }

        var _gasPressure = math.bignumber(parseFloat($("#gasPressure").val()));
        var _gasTemperature = math.bignumber(parseFloat($("#gasTemperature").val()));
        var _atmosphericPressure = math.bignumber(parseFloat($("#atmosphericPressure").val()));
        
        var subPart1 = math.divide(math.bignumber(273), math.add(math.bignumber(273), math.bignumber(_gasTemperature)));
        var subpart2 = math.divide(math.add(math.bignumber(_gasPressure), math.bignumber(_atmosphericPressure)), math.bignumber(_atmosphericPressure));
        var subPart = math.multiply(subPart1, subpart2);
        var res = parseFloat(math.multiply(math.bignumber(_gasDebitM3), subPart));
        $("#gasDebitNM3").val(res.toFixed(2));
        return res;
      };

      var burnerPowerKW = function() {
        var _gasDebitNM3 = math.bignumber(gasDebitNM3());

        if (math.compare(_gasDebitNM3, 0) == 0) {
          return 0;
        }

        var _pciNaturalGas = math.bignumber(parseFloat($("#pciNaturalGas").val()));
        var res = parseFloat(math.multiply(_gasDebitNM3, _pciNaturalGas));
        $("#burnerPowerKW").val(res.toFixed(2));
        return res;
      };
  </script>
</body>

</html>